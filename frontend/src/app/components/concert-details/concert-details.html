<div class="thumbnail">
  @if(concert.images.thumbnail) {
    <img [src]="concert.images.thumbnail" alt="thumbnail"/>
  }

  <div class="thumbnailHeader">
    <div>
      @for (cat of concert.categories; track cat.slug) {
        <a routerLink="/events" [queryParams]="{ category: cat.slug }">{{ cat.title }}</a>
      }
    </div>
  </div>

  <div class="thumbnailFooter">
    <div>
      <i class="fa-solid fa-calendar-days"></i>
      @if(concert.formattedDateStart === concert.formattedDateEnd) {
        <p>{{ concert.formattedDateStart }}</p>
      } @else {
        <p>{{ concert.formattedDateStart }}</p>
        <p>-</p>
        <p>{{ concert.formattedDateEnd }}</p>
      }
    </div>

    <div>
      <i class="fa-solid fa-location-dot"></i>
      <p>{{ concert.locationName }}</p>
    </div>

    <h2>{{ concert.title }}</h2>
  </div>
</div>


<div class="options">
  <div [class.current]="currentSection === 'groups'" (click)="scrollTo('groups')">
    <i class="fa-solid fa-people-group"></i>
    <p>Groups</p>
  </div>

  <div [class.current]="currentSection === 'tickets'" (click)="scrollTo('tickets')">
    <i class="fa-solid fa-ticket"></i>
    <p>Tickets</p>
  </div>

  <div [class.current]="currentSection === 'description'" (click)="scrollTo('description')">
    <i class="fa-solid fa-location-dot"></i>
    <p>Location</p>
  </div>

  <div [class.current]="currentSection === 'description'" (click)="scrollTo('description')">
    <i class="fa-solid fa-message"></i>
    <p>Description</p>
  </div>

  <div [class.current]="currentSection === 'comments'" (click)="scrollTo('comments')">
    <i class="fa-solid fa-comments"></i>
    <p>Comments</p>
  </div>
</div>

<section #musicGroups>
  <div class="sectionContainer">
    <div class="sectionHeader">
      <h2>Groups</h2>
    </div>

    <div class="musicGroups">
      @for (group of concert.groups; track group.slug) {
        <app-music-group-card [group]="group" />
      }
    </div>
  </div>
</section>


<section #tickets>
  <div class="sectionContainer">
    <div class="sectionHeader">
      <h2>Tickets</h2>
    </div>

    <div class="tickets">
      <div class="map">
        @if(concert.images.map) {
          <img [src]="concert.images.map" alt="map image"/>
        } @else {
          <div class="noMap">
            <i class="fa-solid fa-map-location"></i>
            <p>No map available</p>
          </div>
        }
      </div>

      <div class="ticketTypes">
        @for (ticket of concert.tickets; track ticket._id) {
          <app-concert-details-ticket-card [concert]="concert" [currentTicket]="ticket"/>
        }

        <div class="ticketBtns">
          <button class="outline" disabled>Continue</button>
        </div>
      </div>
    </div>
  </div>
</section>


<section #description>
  <div class="sectionContainer">
    <div class="sectionHeader">
      <h2>Description</h2>
    </div>

    <div class="description">
      <div [innerHTML]="concert.description"></div>

      <div>
        <app-carousel [images]="formatCarouselImages()" />
      </div>
    </div>

    <!-- <div class="location" leaflet [leafletOptions]="leafletOptions"></div> -->
    <div #location class="location"></div>
  </div>
</section>

<section #comments>
  <div class="sectionContainer">
    <div class="sectionHeader">
      <h2>Comments</h2>
    </div>

    <div>
      @defer {
        <app-comment-list [getComments]="getComments" [concertSlug]="concert.slug" />
      }
    </div>
  </div>
</section>


<style>
  .thumbnail {
    position: relative;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    height: 400px;
    border-bottom: var(--pico-border-width) solid var(--pico-secondary-border);

    .thumbnailFooter, .thumbnailHeader {
      padding: 20px
    }
    .thumbnailFooter > *, .thumbnailHeader > * {
      display: flex;
      align-items: center;
      gap: 10px
    }

    img {
      height: 100%;
      width: 100%;
      object-fit: cover;
      position: absolute;
      top: 0;
      z-index: -1
    }
  }

  .options {
    position: sticky;
    z-index: 999;
    top: 0;
    display: flex;
    border-bottom: var(--pico-border-width) solid var(--pico-secondary-border);
    background-color: var(--pico-background-color);

    & > div {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 20px;
      cursor: pointer;
      border-right: var(--pico-border-width) solid var(--pico-secondary-border);
    }

    & > *:hover {
      background-color: var(--pico-form-element-background-color);
    }

    .current *:not(i) {
      text-decoration: underline;
      text-decoration-color: var(--pico-primary-underline);
      text-underline-offset: 0.125em;
    }
  }

  .sectionHeader {
    padding: 20px;

    h2 {
      font-size: larger;
    }
  }
  section {
    padding-bottom: 20px;
    border-bottom: var(--pico-border-width) solid var(--pico-secondary-border);

    .sectionContainer {
      max-width: 1500px;
      margin: 0 auto !important;
    }
  }

  .musicGroups {
    padding: 20px;
    display: flex;
    gap: 20px;
    flex-wrap: wrap;

    & > * {
      width: calc(50% - 10px)
    }
  }

  .tickets {
    display: flex;
    max-height: 700px;

    .map {
      width: 50%;
      display: flex;
    }
    .map img {
      object-fit: contain;
    }
    .map .noMap {
      font-size: x-large;
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .ticketTypes {
      width: 50%;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      overflow: auto;
    }

    .ticketBtns {
      display: flex;
    }
    .ticketBtns button {
      flex: 1;
    }
  }

  .description {
    padding: 20px;
    display: flex;
    align-items: center;

    & > * {
      width: 50%;
    }
  }
  .location {
    padding: 20px;
    height: 400px;
  }


  @media (max-width: 1000px) {
    .musicGroups > * {
      width: 100%;
    }
  }

  @media (max-width: 700px) {
    .tickets {
      flex-direction: column;
      max-height: unset;
    }
    .tickets > * {
      width: 100% !important
    }
  }
</style>
