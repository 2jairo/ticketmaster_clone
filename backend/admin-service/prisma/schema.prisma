generator adminClient {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

// generator enterpriseClient {
//   provider = "prisma-client"
//   output   = "../../enterprise-service/apps/shared2/src/generated/prisma"
// }

datasource db {
  provider = "mongodb"
  url      = env("MONGO_URI")
}

enum UserRole {
  CLIENT
  ADMIN
  ROOT
  ENTERPRISE
}

model User {
  id String @id @map("_id") @default(auto()) @db.ObjectId
  v Int @map("__v") @default(0)
  username String @unique
  password String
  email String @unique
  image String @default("https://static.productionready.io/images/smiley-cyrus.jpg")
  followingGroups String[] @db.ObjectId
  followingUsers String[] @db.ObjectId
  followers Int @default(0)
  isActive Boolean @default(true)
  role UserRole

  comments Comment[] @relation("CommentAuthor")
  carts ShoppingCart[] @relation("CartOwner")
  orders Order[] @relation("OrderOwner")
  @@map("users")
}

enum CategoryStatus {
  PENDING
  ACCEPTED
  REJECTED
}

model Category {
  id String @id @map("_id") @default(auto()) @db.ObjectId
  title String
  slug String @unique
  images String[]
  concerts String[] @db.ObjectId
  isActive Boolean @default(true)
  status CategoryStatus @default(PENDING)

  @@map("categories")
}

model Comment {
  id String @id @map("_id") @default(auto()) @db.ObjectId
  createdAt DateTime @default(now()) @db.Date
  updatedAt DateTime @updatedAt
  comment String
  authorId String @db.ObjectId 
  author User @relation("CommentAuthor", fields: [authorId], references: [id])
  likes String[] @db.ObjectId

  @@map("comments")
}

enum MusicGroupStatus {
  PENDING
  ACCEPTED
  REJECTED
}

model MusicGroup {
  id String @id @map("_id") @default(auto()) @db.ObjectId
  title String
  slug String @unique
  description String @default("")
  image String @default("https://static.productionready.io/images/smiley-cyrus.jpg")
  followers Int @default(0)
  status MusicGroupStatus @default(PENDING)
  isActive Boolean @default(true)

  @@map("musicgroups")
}

model MerchCategory {
  id String @id @map("_id") @default(auto()) @db.ObjectId
  title String
  slug String @unique
  image String @default("https://static.productionready.io/images/smiley-cyrus.jpg")
  products Merch[] @relation("MerchCategory")

  @@map("merchcategories")
}

model Merch {
  id String @id @map("_id") @default(auto()) @db.ObjectId
  title String
  slug String @unique
  images String[] @default([])
  description String @default("")
  categoryId String @db.ObjectId
  category MerchCategory @relation("MerchCategory", fields: [categoryId], references: [id])

  stock Int @default(0)
  sold Int @default(0)
  price Int @default(0)

  @@map("merches")
}

model ConcertTickets {
  id String @id @map("_id") @default(auto()) @db.ObjectId
  sold Int @default(0)
  available Int @default(0)
  price Int
  location String
  concertId String @db.ObjectId
  concert Concert @relation("ConcertTickets", fields: [concertId], references: [id])

  @@map("concerttickets")
}


type ShoppingCartItem {
  itemId String //@db.OjectId
  quantity Int
}

model ShoppingCart {
  id String @id @map("_id") @default(auto()) @db.ObjectId
  v Int @map("__v") @default(0)
  userId String @db.ObjectId
  user User @relation("CartOwner", fields: [userId], references: [id])
  tickets ShoppingCartItem[]
  merch ShoppingCartItem[]
  isActive Boolean @default(true)

  @@map("shoppingcarts")
}


enum OrderStatus {
  PENDING
  PAID
  FAILED
  CANCELED
}

model Order {
  id String @id @map("_id") @default(auto()) @db.ObjectId
  userId String @db.ObjectId
  user User @relation("OrderOwner", fields: [userId], references: [id])
  tickets ShoppingCartItem[]
  merch ShoppingCartItem[]
  status OrderStatus @default(PENDING)
  totalAmmount Int
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
  paymemt Payment? @relation("OrderPayment")

  @@map("orders")
}
 
enum PaymentStatus {
  PENDING
  COMPLETED
}

model Payment {
  id String @id @map("_id") @default(auto()) @db.ObjectId
  orderId String @db.ObjectId @unique
  order Order @relation("OrderPayment", fields: [orderId], references: [id])
  totalAmmount Int
  method String
  currency String
  transactionRef String
  status PaymentStatus @default(PENDING)
  createdAt DateTime @default(now())
  paidAt DateTime @default(now())

  
  @@map("payments")
}

type ConcertLocation {
  type String
  coordinates Float[]
}

enum ConcertStatus {
  PENDING
  ACCEPTED
  REJECTED
}

model Concert {
  id String @id @map("_id") @default(auto()) @db.ObjectId
  title String
  slug String @unique
  dateStart DateTime @db.Date
  dateEnd DateTime @db.Date
  description String
  images String[]
  mapImg String?
  thumbnailImg String?
  locationName String
  location ConcertLocation
  totalTicketsSold Int @default(0)
  tickets ConcertTickets[] @relation("ConcertTickets")
  groups String[] @db.ObjectId
  categories String[] @db.ObjectId
  comments String[] @db.ObjectId
  isActive Boolean @default(true)
  status ConcertStatus @default(PENDING)

  @@map("concerts")
}
